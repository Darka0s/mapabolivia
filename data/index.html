<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mapa interactivo — Municipios</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <style>
    html, body, #map { height: 100%; margin: 0; }
    .toolbar { position: absolute; z-index: 1000; top: 12px; left: 12px; background: #fff; padding: 8px 12px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,.15); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    .toolbar button { padding: 6px 10px; border: 0; border-radius: 8px; cursor: pointer; box-shadow: 0 1px 4px rgba(0,0,0,.15); }
    .toolbar .count { margin-left: 8px; opacity: .75; }
    .legend { position: absolute; right: 12px; bottom: 12px; background: #fff; padding: 8px 12px; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,.15); font-size: 13px; }
    .legend .box { display: inline-block; width: 14px; height: 14px; vertical-align: -2px; margin-right: 6px; border: 1px solid #999; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="toolbar">
    <button id="reset">Quitar selección</button>
    <span class="count" id="count">0 seleccionados</span>
  </div>
  <div class="legend">
    <div><span class="box" style="background:#f2f2f2"></span>No seleccionado</div>
    <div><span class="box" style="background:#2ecc71"></span>Seleccionado</div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    // === CONFIGURA AQUÍ ===
    // 1) Ruta a tu GeoJSON exportado desde el shapefile (EPSG:4326 / WGS84)
    const GEOJSON_URL = 'data/municipios.geojson';
    // 2) Nombre del campo que contiene el nombre del municipio en tu archivo
    //    Ajusta esto según tus atributos (por ejemplo: 'NOM_MUN', 'NOMBRE', 'MUNICIPIO')
    const NAME_FIELD = 'NOMBRE';

    // === MAPA ===
    const map = L.map('map', { zoomSnap: .5 }).setView([-16.5, -64.9], 5); // Centro aproximado de Bolivia

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const defaultStyle = {
      color: '#666',        // contorno
      weight: 1,
      fillColor: '#f2f2f2', // relleno base
      fillOpacity: 0.9
    };

    const selectedStyle = {
      color: '#2d8659',
      weight: 2,
      fillColor: '#2ecc71',
      fillOpacity: 0.8
    };

    let selectedIds = new Set();
    let layerRef = null;

    function updateCount() {
      document.getElementById('count').textContent = `${selectedIds.size} seleccionados`;
    }

    function onEachFeature(feature, layer) {
      // Cada polígono de municipio
      layer.options.style = defaultStyle;

      // Tooltip con nombre
      const name = feature.properties?.[NAME_FIELD] ?? '(sin nombre)';
      layer.bindTooltip(name, { sticky: true });

      // Identificador estable: usa un campo único si existe, si no, usa Leaflet_id
      const fid = feature.properties?.OBJECTID ?? feature.properties?.ID ?? layer._leaflet_id;

      // Click: alterna selección
      layer.on('click', () => {
        if (selectedIds.has(fid)) {
          selectedIds.delete(fid);
          layer.setStyle(defaultStyle);
        } else {
          selectedIds.add(fid);
          layer.setStyle(selectedStyle);
        }
        updateCount();
      });

      // Hover: resalta borde
      layer.on('mouseover', () => layer.setStyle({ weight: 3 }));
      layer.on('mouseout', () => {
        const base = selectedIds.has(fid) ? selectedStyle : defaultStyle;
        layer.setStyle({ ...base, weight: selectedIds.has(fid) ? 2 : 1 });
      });
    }

    // Carga GeoJSON
    fetch(GEOJSON_URL)
      .then(r => r.json())
      .then(data => {
        layerRef = L.geoJSON(data, {
          style: () => defaultStyle,
          onEachFeature
        }).addTo(map);
        map.fitBounds(layerRef.getBounds());
      })
      .catch(err => alert('Error cargando el GeoJSON: ' + err.message));

    // Botón reset
    document.getElementById('reset').addEventListener('click', () => {
      selectedIds.clear();
      if (layerRef) {
        layerRef.setStyle(defaultStyle);
      }
      updateCount();
    });
  </script>
</body>
</html>
